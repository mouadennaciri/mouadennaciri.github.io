<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i|Fira+Mono"
    />
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./css/default.css" />
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="Mouad Ennaciri" />
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjMDAwMDAwIi8+Cjx0ZXh0IHg9Ijk2IiB5PSIxMTAiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk08L3RleHQ+Cjwvc3ZnPgo=" />
    <title>Mouad Ennaciri - Accueil</title>
  </head>
  <body>
    <main class="wrapper">
      <div>
        <h1>Mouad Ennaciri</h1>
        <p>
          D√©veloppeur en jour comme en nuit, <i>Fan</i> de la fiction et de La
          Guerre des √âtoiles (ou les Guerres de l'√âtoile si tu veux).
        </p>
        <div class="menu">
          <a href="https://www.reddit.com/user/Mouadennaciri">Reddit</a>
          <a href="https://twitter.com/mouadenn">Twitter</a>
          <a href="https://www.github.com/mouadennaciri/">GitHub</a>
        </div>
        
        <button id="installButton" class="install-button" style="display: none;">
          üì± Installer l'application
        </button>
      </div>

      <div class="articles">
        <h2>Articles</h2>
        <ul>
          <li>
            <a href="./posts/angular-templates-stricts.html"
              >Angular : des templates stricts et des diagnostiques √©tendus</a
            >
          </li>
          <li>
            <a href="./posts/polymorphism-adhoc.html"
              >TypeScript : polymorphisme ad hoc</a
            >
          </li>
          <li>
            <a href="./posts/complexity.html"
              >Complexit√© cyclomatique et complexit√© cognitive</a
            >
          </li>
          <li>
            <a href="./posts/weakset.html">JavaScript : l'objet WeakSet</a>
          </li>
          <li>
            <a href="./posts/type-inference.html"
              >L'inf√©rence de type dans TypeScript et Go</a
            >
          </li>
        </ul>
      </div>
    </main>
    <script src="./js/hl.js" type="application/javascript"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js')
            .then(function(registration) {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, function(err) {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }

      // PWA Install functionality
      let deferredPrompt;
      const installButton = document.getElementById('installButton');

      // Function to check if app can be installed
      function checkInstallability() {
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                           window.navigator.standalone === true;
        
        if (isStandalone) {
          installButton.style.display = 'none';
          return;
        }

        // Check for Android Chrome specifically
        const isAndroidChrome = /Android.*Chrome/i.test(navigator.userAgent) && 
                               !/Edg|OPR|Samsung/i.test(navigator.userAgent);
        const isSecure = window.location.protocol === 'https:' || window.location.hostname === 'localhost';
        
        console.log('Android Chrome detected:', isAndroidChrome);
        console.log('Secure context:', isSecure);
        console.log('Service Worker supported:', 'serviceWorker' in navigator);
        
        // For Android Chrome, wait for service worker registration and show button
        if (isAndroidChrome && isSecure && 'serviceWorker' in navigator) {
          setTimeout(() => {
            if (!isStandalone && !deferredPrompt) {
              console.log('Showing install button for Android Chrome');
              installButton.style.display = 'block';
            }
          }, 3000); // Wait longer for SW registration
        }
      }

      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('beforeinstallprompt fired');
        e.preventDefault();
        deferredPrompt = e;
        installButton.style.display = 'block';
      });

      installButton.addEventListener('click', async () => {
        if (deferredPrompt) {
          console.log('Using deferredPrompt');
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === 'accepted') {
            console.log('User accepted the install prompt');
            installButton.style.display = 'none';
          }
          deferredPrompt = null;
        } else {
          console.log('No deferredPrompt available');
          // Fallback for browsers without beforeinstallprompt
          const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
          const isAndroidChrome = /Android.*Chrome/i.test(navigator.userAgent);
          
          if (isIOS) {
            alert('Pour installer cette app sur iOS:\n1. Appuyez sur le bouton de partage\n2. S√©lectionnez "Ajouter √† l\'√©cran d\'accueil"');
          } else if (isAndroidChrome) {
            alert('Pour installer cette app sur Android:\n1. Appuyez sur le menu ‚ãÆ de Chrome\n2. S√©lectionnez "Ajouter √† l\'√©cran d\'accueil"');
          } else {
            alert('Pour installer cette app:\n1. Ouvrez le menu du navigateur\n2. S√©lectionnez "Ajouter √† l\'√©cran d\'accueil" ou "Installer l\'application"');
          }
        }
      });

      window.addEventListener('appinstalled', () => {
        console.log('PWA was installed');
        installButton.style.display = 'none';
        deferredPrompt = null;
      });

      // Check installability on load and after SW registration
      window.addEventListener('load', () => {
        setTimeout(checkInstallability, 1000);
      });
    </script>
  </body>
</html>
